# è´å¶æ–¯å› å­çš„è®¡ç®—ä¸åº”ç”¨

ä¹‹å‰æˆ‘ä»¬å·²ç»å‘å¤§å®¶ä»‹ç»äº† HDI + ROPE (æœ€é«˜å¯†åº¦åŒºé—´ + é¢„è®¾æ•ˆåº”èŒƒå›´)æ–¹æ³•ï¼Œé‚£ä¹ˆï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬ä¼šä¸»è¦åŸºäºè´å¶æ–¯å› å­æ¥è¿›è¡Œæ¨¡å‹æ¨æ–­çš„è®²è§£ã€‚

## ç®€å•çº¿æ€§å›å½’æ¨¡å‹çš„å‡è®¾æ£€éªŒ

è´å¶æ–¯å›å½’ä¸ä¼ ç»Ÿå›å½’æ¨¡å‹ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡å…ˆéªŒåˆ†å¸ƒã€ä¼¼ç„¶å‡½æ•°å’ŒåéªŒåˆ†å¸ƒæ¥è¿›è¡Œæ¨æ–­ã€‚

æˆ‘ä»¬ä¾æ—§æ²¿ç”¨ä¹‹å‰è‡ªæˆ‘åŒ¹é…èŒƒå¼çš„ä¾‹å­ï¼Œä»¥**æ¢ç©¶ä¸¤ç§æ¡ä»¶ï¼ˆselfä¸otherï¼‰ä¸‹çš„ååº”æ—¶å·®å¼‚**ã€‚

- è¿™é‡Œçš„$X_i$æœ‰ä¸¤ä¸ªå–å€¼ï¼Œåˆ†åˆ«æ˜¯0å’Œ1ï¼ŒæŒ‡ä»£selfå’Œotherä¸¤ä¸ªæ°´å¹³ã€‚æ­¤å¤–ï¼Œè¿™é‡Œè¿˜æœ‰3ä¸ªå‚æ•°ï¼Œ$\beta_0ï¼Œ\beta_1å’Œ\sigma$ã€‚

$$
\beta_0 \sim N(m_0,s_0^2)\\
\beta_1 \sim N(m_1,s_1^2)\\
\sigma \sim Exp(\lambda)\\
\Downarrow\\
\mu_i=\beta_0+\beta_1X_i\\
\Downarrow\\
Y_i|\beta_0,\beta_1,\sigma \sim N(\mu_i,\sigma^2)
$$

![alt text](image-2.png)

- è¿™é‡Œæ¶‰åŠä»tæ£€éªŒåˆ°ç”¨ç®€å•å›å½’æ¨¡å‹åštæ£€éªŒçš„ä¸€ä¸ªè¿‡æ¸¡

å‡è®¾æ£€éªŒï¼š

- é›¶å‡è®¾ï¼ˆ$H_0$ï¼‰:$\beta_1=0$

- å¤‡æ‹©å‡è®¾ï¼ˆ$H_1$ï¼‰:$\beta_1â‰ 0$

### å‡è®¾æ£€éªŒ vs. è´å¶æ–¯å› å­

åœ¨ä¼ ç»Ÿå‡è®¾æ£€éªŒä¸­ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—å‡ºä¸€ä¸ªPå€¼ï¼Œå¦‚æœPå€¼å°äºç­‰äºè®¾å®šçš„æ˜¾è‘—æ€§æ°´å¹³ï¼ˆä¾‹å¦‚ 0.

ä¸ä¼ ç»Ÿçš„å‡è®¾æ£€éªŒæ–¹æ³•ä¸åŒï¼Œè´å¶æ–¯ç»Ÿè®¡ä½¿ç”¨ è´å¶æ–¯å› å­ï¼ˆBayes Factorï¼ŒBFï¼‰ æ¥è¡¡é‡ä¸åŒæ¨¡å‹ä¹‹é—´çš„ç›¸å¯¹è¯æ®å¼ºåº¦ã€‚

- **è´å¶æ–¯å› å­ä¸æ˜¯åŸºäºpå€¼ï¼Œè€Œæ˜¯é€šè¿‡æ¯”è¾ƒæ¨¡å‹é—´çš„åéªŒæ¦‚ç‡æ¥å¾—å‡ºç»“è®ºã€‚**

> ğŸ’¡æ³¨æ„ï¼šåœ¨æœ¬è¯¾ä¸­æˆ‘ä»¬å…³æ³¨çš„æ˜¯ä¸¤ä¸ªæ¡ä»¶ä¹‹é—´çš„å·®å¼‚ï¼Œå› æ­¤æˆ‘ä»¬ä»…é‡ç‚¹å…³æ³¨$\beta_1$ï¼Œå› ä¸ºå®ƒåæ˜ äº†selfå’Œotheræ¡ä»¶ä¹‹é—´çš„ååº”æ—¶é—´å·®å¼‚ã€‚

ğŸ¤”å…·ä½“è€Œè¨€ï¼Œ"è´å¶æ–¯å› å­èƒ½ç”¨æ¥å›ç­”ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ"

è´å¶æ–¯å› å­éå¸¸çµæ´»ï¼Œå› ä¸ºå®ƒä¸ä»…å¯ä»¥ç”¨äºç®€å•çš„å‡è®¾æ£€éªŒï¼Œè¿˜å¯ä»¥ç”¨äºæ¯”è¾ƒå¤æ‚æ¨¡å‹ã€è¯„ä¼°æ¨¡å‹æ‹Ÿåˆä¼˜åº¦ã€ä»¥åŠåœ¨å¤šæ¨¡å‹æ¯”è¾ƒä¸­æä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚

**ä»¥ä¸‹æ˜¯è´å¶æ–¯å› å­å¸¸è§çš„ä¸‰ç§åº”ç”¨åŠå¯èƒ½çš„å‡è®¾ç¤ºä¾‹ï¼š**

å¯¹äºè‡ªå˜é‡ ï¼ˆLabelï¼‰ å› å˜é‡ï¼ˆRT_secï¼‰ çš„å…³ç³»ï¼š

- æˆ‘ä»¬çš„ä¸»è§‚çŒœæƒ³æ˜¯ï¼šåœ¨selfæ¡ä»¶ä¸‹æ—¶çš„ååº”æ—¶é—´æ¯”åœ¨otheræ¡ä»¶ä¸‹æ›´çŸ­ã€‚

- åœ¨ç¬¬å…«èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬çš„å…ˆéªŒè®¾å®šä¹Ÿåæ˜ äº†æˆ‘ä»¬çš„ä¸»è§‚ä¿¡å¿µï¼Œä½†æ˜¯æ”¯æŒæˆ‘ä»¬å‡è®¾çš„è¯æ®æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è¯æ˜ï¼Ÿ

- å¦‚ä½•æ£€éªŒ$\beta_1=0$ï¼ˆé›¶å‡è®¾ï¼‰ä¸$\beta_1â‰ 0$ï¼ˆå¤‡æ‹©å‡è®¾ï¼‰ä¹‹é—´çš„å…³ç³»ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è´å¶æ–¯å› å­æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªæ¨¡å‹ï¼Œè®¡ç®—è´å¶æ–¯å› å­$BF_{10}$,æ¥é‡åŒ–é›¶å‡è®¾å’Œå¤‡æ‹©å‡è®¾ä¹‹é—´çš„è¯æ®å·®å¼‚ã€‚

å‡ ç§å¯èƒ½å»æ£€éªŒç ”ç©¶å‡è®¾çš„åšæ³•ï¼š

**1ã€Testing against the point-null**

è´å¶æ–¯å› å­å¯ä»¥ç”¨æ¥æ£€éªŒæŸä¸ªå‚æ•°æ˜¯å¦ç­‰äºé›¶ï¼Œå³æ£€éªŒç‚¹çš„é›¶å‡è®¾ã€‚

**2ã€Testing against a null-region**

æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¾å®šä¸€ä¸ªâ€œé›¶åŒºåŸŸâ€ï¼Œå³ä¸€ä¸ªå‚æ•°å€¼çš„èŒƒå›´ï¼Œè¯¥èŒƒå›´å†…çš„å€¼è¢«è®¤ä¸ºä¸é›¶æ²¡æœ‰æ˜¾è‘—å·®å¼‚ã€‚å‡è®¾æˆ‘ä»¬è®¾å®šä¸€ä¸ªåŒºé—´$\beta_1 \in [-0.05,0.05]$ï¼Œè®¤ä¸º$\beta_1$è½åœ¨è¿™ä¸ªåŒºé—´å†…æ˜¯å¯ä»¥æ¥å—çš„æ— æ•ˆæ•ˆåº”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª0å€¼é™„è¿‘çš„åŒºé—´ï¼Œå½“$\beta_1$è½åœ¨è¿™ä¸ªåŒºé—´ä¹‹å¤–ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºå·®å¼‚æ˜¯æœ‰æ„ä¹‰çš„ã€‚

**3ã€Directional hypotheses**

è´å¶æ–¯å› å­ä¹Ÿå¯ä»¥ç”¨äºæ£€éªŒæŸä¸ªå‚æ•°æ˜¯å¦æœ‰ç‰¹å®šçš„æ–¹å‘æ€§ï¼Œå³æ˜¯å¦å­˜åœ¨æ­£å‘æˆ–è´Ÿå‘çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æå‡ºå‡è®¾$H_1:\beta_1>0$ï¼Œè®¤ä¸ºè‡ªå˜é‡ï¼ˆLabelï¼‰å¯¹å› å˜é‡ï¼ˆRT_secï¼‰æœ‰æ­£å‘å½±å“ã€‚è´å¶æ–¯å› å­å°†å¸®åŠ©æˆ‘ä»¬è¯„ä¼°æ•°æ®æ˜¯å¦æ”¯æŒè¿™ç§æ–¹å‘æ€§çš„å‡è®¾ï¼Œè€Œä¸ä»…ä»…æ˜¯æ”¯æŒæˆ–æ‹’ç»é›¶å‡è®¾ã€‚

ğŸ‘ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ç¤ºä¾‹å‘å¤§å®¶ä»‹ç»è¿™ä¸‰ç§æ–¹æ³•ã€‚

### Testing Modelsâ€™ Parameters with Bayes Factor

**Testing against the point-null**

æˆ‘ä»¬å¯ä»¥é¦–å…ˆä»æœ€ç®€å•çš„å‡è®¾å¼€å§‹ï¼Œå³å‡è®¾æ²¡æœ‰æ•ˆåº”ï¼Œselfå’Œotheræ¡ä»¶ä¸‹çš„ååº”æ—¶é—´ç›¸åŒï¼Œå³æ¢ç©¶ $\beta_1$ æ˜¯å¦ç­‰äºé›¶ğŸ¤”

å½“æˆ‘ä»¬æ£€éªŒå‚æ•°æ˜¯å¦ç­‰äºé›¶æ—¶ï¼ˆå¦‚æ£€éªŒå‚æ•° $\beta_1 = 0$ï¼‰ï¼Œè¿™å°±æ˜¯ç‚¹é›¶å‡è®¾çš„æ£€éªŒã€‚

è´å¶æ–¯å› å­å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¡¡é‡æ•°æ®å¯¹ç‚¹é›¶å‡è®¾ä¸éé›¶å‡è®¾çš„æ”¯æŒç¨‹åº¦ã€‚åœ¨å›å½’æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªé›¶å‡è®¾ $H_0: \beta_1 = 0$ å’Œå¤‡æ‹©å‡è®¾ $H_1: \beta_1 \neq 0$ï¼Œç„¶åä½¿ç”¨è´å¶æ–¯å› å­æ¥è®¡ç®—é›¶å‡è®¾å’Œå¤‡æ‹©å‡è®¾çš„ç›¸å¯¹è¯æ®ã€‚

$$
BF_{10} = \frac{P(Data|H_1)}{P(Data|H_0)}=\frac{P(Data|\beta_1â‰ 0)}{P(Data|\beta_1=0)}
$$

æˆ‘ä»¬è¿˜æ˜¯ä»¥ç¼–å·ä¸º"201"çš„è¢«è¯•æ•°æ®ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼š

```python
# å¯¼å…¥ pymc æ¨¡å‹åŒ…ï¼Œå’Œ arviz ç­‰åˆ†æå·¥å…· 
import pymc as pm
import arviz as az
import scipy.stats as st
import numpy as np
import matplotlib.pyplot as plt
import xarray as xr
import pandas as pd

# å¿½ç•¥ä¸å¿…è¦çš„è­¦å‘Š
import warnings
warnings.filterwarnings("ignore")

# é€šè¿‡ pd.read_csv åŠ è½½æ•°æ® Kolvoort_2020_HBM_Exp1_Clean.csv
try:
  df_raw = pd.read_csv('/home/mw/input/bayes3797/Kolvoort_2020_HBM_Exp1_Clean.csv')
except:
  df_raw = pd.read_csv('/home/jovyan/data/Kolvoort_2020_HBM_Exp1_Clean.csv')

# ç­›é€‰å‡ºè¢«è¯•"201"ï¼ŒåŒ¹é…ç±»å‹ä¸º"Matching"çš„æ•°æ®
df_raw["Subject"] = df_raw["Subject"].astype(str)
df = df_raw[(df_raw["Subject"] == "201") & (df_raw["Matching"] == "Matching")]

# é€‰æ‹©éœ€è¦çš„ä¸¤åˆ—
df = df[["Label", "RT_sec"]]

# é‡æ–°ç¼–ç æ ‡ç­¾ï¼ˆLabelï¼‰
df["Label"] = df["Label"].map({1: 0, 2: 1, 3: 1})

# #è®¾ç½®ç´¢å¼•
df["index"] = range(len(df))
df = df.set_index("index")

# #ä¿å­˜æ•°æ®
# df.to_csv('/home/jovyan/data/Kolvoort_2020_HBM_Exp1_Clean_201.csv', index=False)

# æ˜¾ç¤ºéƒ¨åˆ†æ•°æ®
df.head()
```

**æ ¹æ®æˆ‘ä»¬çš„æ¨¡å‹ï¼š**

$$
Y_i = \beta_0,\beta_1,\sigma \sim N(\mu_i,\sigma^2)
$$

**å…ˆéªŒï¼ˆpriorï¼‰**ï¼š

$\beta_{0} \sim N\left(5, 2^2 \right)$
- æ¨¡å‹çš„æˆªè·é¡¹æœä»å‡å€¼ä¸º 5ï¼Œæ ‡å‡†å·®ä¸º 2 çš„æ­£æ€åˆ†å¸ƒã€‚

$\beta_1 \sim N\left(0, 1^2 \right)$
- æ¨¡å‹çš„æ–œç‡é¡¹ï¼Œæœä»å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒã€‚

$\sigma \sim \text{Exp}(0.3)$
- ä»£è¡¨è¯¯å·®é¡¹çš„æ ‡å‡†å·®ï¼Œæœä»å‚æ•°ä¸º 0.3 çš„æŒ‡æ•°åˆ†å¸ƒã€‚

**ä¼¼ç„¶ï¼ˆlikelihoodï¼‰**

- $\mu_i = \beta_0 + \beta_1X_i$

- $Y_i {\sim} N\left(\mu_i, \sigma^2\right)$

**æ¨¡å‹å®šä¹‰ï¼š**

```python
# è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿ç»“æœå¯å¤ç°
np.random.seed(123)

with pm.Model() as linear_model:

    # å®šä¹‰å…ˆéªŒåˆ†å¸ƒå‚æ•°
    beta_0 = pm.Normal("beta_0", mu=5, sigma=2)        
    beta_1 = pm.Normal("beta_1", mu=0, sigma=1)      
    sigma = pm.Exponential("sigma", 3)                    

    # å®šä¹‰è‡ªå˜é‡ x
    x = pm.MutableData("x", df['Label'])         

    # å®šä¹‰ muï¼Œå°†è‡ªå˜é‡ä¸å…ˆéªŒç»“åˆ
    mu = beta_0 + beta_1 * x

    # å®šä¹‰ä¼¼ç„¶ï¼šé¢„æµ‹å€¼yç¬¦åˆN(mu, sigma)åˆ†å¸ƒ
    likelihood = pm.Normal("y_est", mu=mu, sigma=sigma, observed=df['RT_sec'])
```

**åéªŒé‡‡æ ·ï¼š**

```python
with linear_model:
    trace = pm.sample(draws=5000,                   # ä½¿ç”¨mcmcæ–¹æ³•è¿›è¡Œé‡‡æ ·ï¼Œdrawsä¸ºé‡‡æ ·æ¬¡æ•°
                      tune=1000,                    # tuneä¸ºè°ƒæ•´é‡‡æ ·ç­–ç•¥çš„æ¬¡æ•°ï¼Œå¯ä»¥å†³å®šè¿™äº›ç»“æœæ˜¯å¦è¦è¢«ä¿ç•™
                      chains=4,                     # é“¾æ•°
                      discard_tuned_samples=True,  # tuneçš„ç»“æœå°†åœ¨é‡‡æ ·ç»“æŸåè¢«ä¸¢å¼ƒ
                      random_seed=84735)
```

```python
trace.posterior['beta_1']
```

**MCMCè¯Šæ–­**

```python
axes = az.plot_trace(trace)
plt.tight_layout()
plt.show()
```

![alt text](image-3.png)

```python
az.summary(trace)
```

![alt text](image-4.png)

**Arviz å®ç°è®¡ç®—è´å¶æ–¯å› å­**

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†$\beta_1$çš„å…ˆéªŒåˆ†å¸ƒå’ŒåéªŒåˆ†å¸ƒï¼Œæˆ‘ä»¬åˆ†åˆ«è®¡ç®—è´å¶æ–¯å› å­$BF_{10}å’ŒBF_{01}$,åˆ†åˆ«è¡¨ç¤ºæ•°æ®æ”¯æŒå¤‡æ‹©å‡è®¾å’Œé›¶å‡è®¾çš„è¯æ®å¼ºåº¦ã€‚

åœ¨ Python çš„ Arviz åº“ä¸­ï¼Œ`arviz.plot_bf` å‡½æ•°æä¾›äº†ç›´æ¥è®¡ç®—è´å¶æ–¯å› å­çš„æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å…ˆéªŒå’ŒåéªŒåˆ†å¸ƒåœ¨é›¶å‡è®¾ç‚¹å¤„çš„æ¦‚ç‡å¯†åº¦å€¼è¿›è¡Œå¯è§†åŒ–ã€‚

```python
import seaborn as sns

# è¿›è¡Œè´å¶æ–¯å› å­è®¡ç®—ï¼Œéœ€è¦é‡‡æ ·å…ˆéªŒåˆ†å¸ƒ
with linear_model:
    trace.extend(pm.sample_prior_predictive(5000, random_seed=84735) )

# ç»˜åˆ¶è´å¶æ–¯å› å­å›¾
az.plot_bf(trace, var_name="beta_1", ref_val=0)

# è®¾ç½® x è½´çš„èŒƒå›´
plt.xlim(-0.5, 0.5) 

# å»é™¤ä¸Šæ¡†çº¿å’Œå³æ¡†çº¿
sns.despine()
```

![alt text](image-5.png)

- ç»“æœæ˜¾ç¤º$BF_{10}=6$ï¼Œè¯æ˜æ›´å¤šçš„è¯æ®æ”¯æŒ$H_1$ã€‚

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®é™…ä¸Šæ˜¯é’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„ç‚¹ï¼Œè®¡ç®—å‡ºå…ˆéªŒåˆ†å¸ƒä¼¼ç„¶å€¼å’ŒåéªŒåˆ†å¸ƒä¼¼ç„¶å€¼ä¹‹é—´çš„ä¸€ä¸ªæ¯”å€¼ã€‚

- è¿™æ˜¯ä¸€ç§å·²è¢«è¯å®çš„è®¡ç®—è´å¶æ–¯å› å­çš„ç®€åŒ–æ–¹æ³•ã€‚æˆ‘ä»¬è®¾å®šçš„$H_0å‡è®¾$ä¸º$\beta_1=0$ï¼Œå› æ­¤æ­¤å¤„è®¾å®š`ref_val=0`ï¼Œç„¶ååˆ†åˆ«è®¡ç®—å‡ºå…ˆéªŒåœ¨0å€¼å¤„çš„ä¼¼ç„¶å’ŒåéªŒåœ¨0å€¼å¤„çš„ä¼¼ç„¶ï¼Œæœ€åè¿›è¡Œæ¯”å€¼å¾—å‡º$BF_{01}$ã€‚

- éœ€è¦æ³¨æ„ï¼šæ¯æ¬¡mcmcåå¾—å‡ºçš„è´å¶æ–¯å› å­çš„å…·ä½“å€¼å¯èƒ½ä¼šä¸åŒï¼Œè¿™æ˜¯æ­£å¸¸çš„ç°è±¡ã€‚

é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼š

- $BF_{10}=6$ï¼šè¡¨ç¤ºæ•°æ®æ”¯æŒ$H_1$çš„å¼ºåº¦ç›¸å¯¹äº$H_0$ä¸º6ã€‚

- $BF_{01}=0.17$ï¼šè¡¨ç¤ºæ•°æ®æ”¯æŒ$H_0$çš„å¼ºåº¦ç›¸å¯¹äº$H_1$ä¸º0.17ã€‚

æ€»ç»“ï¼šé€šè¿‡è´å¶æ–¯å› å­çš„è®¡ç®—ï¼Œå¯¹äºæ•°æ®å€¾å‘äºæ”¯æŒ$\beta_1â‰ 0$ï¼Œå³æ•°æ®ä¸ºå­˜åœ¨æ•ˆåº”çš„å‡è®¾æä¾›äº†ä¸­ç­‰å¼ºåº¦çš„è¯æ®ã€‚

***è¡¥å……å†…å®¹ ï¼šä¸ JASP çš„å¯¹æ¯”***
åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ Arviz æ¥è®¡ç®—è´å¶æ–¯å› å­ï¼Œé€šè¿‡ç›´æ¥æ¯”è¾ƒå…ˆéªŒå’ŒåéªŒåˆ†å¸ƒåœ¨é›¶ç‚¹çš„å¯†åº¦å·®å¼‚æ¥æ£€éªŒæŸä¸ªæ•ˆåº”æ˜¯å¦ä¸ºé›¶ã€‚

ç„¶è€Œï¼ŒJASPï¼ˆJeffreys's Amazing Statistics Programï¼‰æä¾›äº†ä¸€ç§ä¸åŒçš„æ–¹æ³•æ¥è®¡ç®—è´å¶æ–¯å› å­ï¼š

- JASP æ˜¯ä¸€ä¸ªåŸºäº R è¯­è¨€çš„å¼€æºè½¯ä»¶ï¼Œä»¥å…¶æ˜“ç”¨æ€§å’Œå‹å¥½çš„å›¾å½¢ç•Œé¢å¹¿å—æ¬¢è¿ï¼Œä¸»è¦ç”¨äºå¿ƒç†å­¦ã€ç¤¾ä¼šå­¦ç­‰é¢†åŸŸçš„ç»Ÿè®¡åˆ†æã€‚

- JASP ä½¿ç”¨è´å¶æ–¯æ¨¡å‹æ¥è®¡ç®—è´å¶æ–¯å› å­ï¼ŒåŒ…æ‹¬æ¨¡å‹æ¯”è¾ƒå’Œæ¡¥é‡‡æ ·æ³•ï¼ˆBridge Samplingï¼‰ç­‰æŠ€æœ¯ï¼Œèƒ½å¤Ÿé€šè¿‡è®¡ç®—åéªŒå’Œå…ˆéªŒåˆ†å¸ƒçš„æ¯”å€¼ï¼Œè¯„ä¼°ä¸åŒæ¨¡å‹æˆ–å‡è®¾çš„ç›¸å¯¹æ”¯æŒç¨‹åº¦ã€‚ä¸ Savage-Dickey æ–¹æ³•ä¸åŒï¼Œæ¡¥é‡‡æ ·ä¸å±€é™äºå•å‚æ•°æˆ–ç®€å•å‡è®¾ï¼Œå› æ­¤æ›´é€‚åˆæ¨¡å‹æ¯”è¾ƒå’Œå¤æ‚å‡è®¾æ£€éªŒã€‚

**Python ç‰ˆæœ¬çš„ JASP å®ç°**

åœ¨ Python ä¸­ï¼Œè™½ç„¶æ²¡æœ‰å®˜æ–¹çš„ JASP APIï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ arviz.compare å®ç°ç±»ä¼¼ JASP ä¸­æ¨¡å‹æ¯”è¾ƒçš„æ–¹æ³•æ¥è®¡ç®—è´å¶æ–¯å› å­ã€‚

- éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦è®¡ç®—è´å¶æ–¯å› å­ï¼Œéœ€è¦è·å¾—æ¨¡å‹çš„è¾¹é™…ä¼¼ç„¶ï¼ˆMarginal Likelihoodï¼‰ï¼Œå³æ¨¡å‹ä¸­æ‰€æœ‰å‚æ•°çš„è”åˆä¼¼ç„¶ã€‚

- PyMC æä¾›äº† pm.compute_log_likelihood æ–¹æ³•ï¼Œå¯ä»¥è®¡ç®—æ¨¡å‹ä¸­æ‰€æœ‰å‚æ•°çš„è”åˆä¼¼ç„¶ã€‚

åœ¨arviz.compare()çš„è¾“å‡ºä¸­ï¼Œæ²¡æœ‰ç›´æ¥æä¾›è´å¶æ–¯å› å­ï¼ˆBFï¼‰çš„å€¼ã€‚è´å¶æ–¯å› å­æ˜¯ç”¨æ¥æ¯”è¾ƒæ¨¡å‹çš„ä¼¼ç„¶ï¼ˆæˆ–åéªŒæ¦‚ç‡ï¼‰çš„ä¸€ç§åº¦é‡ï¼Œå¯ä»¥é€šè¿‡æƒé‡(weight) æ¥é—´æ¥ç†è§£æ¨¡å‹çš„ç›¸å¯¹ä¼˜åŠ£ï¼Œä½†å®ƒä¸æ˜¯ç›´æ¥çš„è´å¶æ–¯å› å­ã€‚

$$
BF_{10}=\frac{weight~of~model1}{weight~of~model2}
$$

***æ³¨æ„ï¼šç”±äºè¿™é‡Œçš„æ–¹æ³•åŸºäºæ¨¡å‹æ¯”è¾ƒï¼Œå®ƒæ›´é€‚åˆæ¨¡å‹æ¯”è¾ƒå’Œå¤æ‚å‡è®¾æ£€éªŒï¼Œå› æ­¤å’Œ Savage-Dickey æ–¹æ³•ä¸åŒã€‚***

ä½†å¯ä»¥çœ‹åˆ°ä¸¤è€…ç»“æœçš„ç»“è®ºåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼š$BF_{10}(SDæ–¹æ³•)=5.16$ï¼›$BF_{10}(æ¨¡å‹æ¯”è¾ƒ)=10.10$

***æ³¨æ„ï¼šåœ¨JASPçš„å®é™…è¿ç®—ä¸­ï¼Œè½¯ä»¶ä¼šè‡ªåŠ¨è°ƒæ•´å…ˆéªŒï¼Œå› æ­¤ä¸æˆ‘ä»¬è®¾ç½®çš„å…ˆéªŒä¸åŒï¼Œè®¡ç®—å¾—åˆ°çš„è´å¶æ–¯å› å­ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚***

```python
# å®šä¹‰é›¶å‡è®¾æ¨¡å‹ï¼ˆä»…åŒ…å«æˆªè·çš„æ¨¡å‹ï¼‰
with pm.Model() as model_H0:

    beta_0 = pm.Normal("beta_0", mu=5, sigma=2)        
    sigma = pm.Exponential("sigma", 3)                    
    mu = beta_0
    likelihood = pm.Normal("y_est", mu=mu, sigma=sigma, observed=df['RT_sec'])  
    trace_H0 = pm.sample(draws=5000, tune=1000, chains=4,discard_tuned_samples=True, random_seed=84735)
    pm.compute_log_likelihood(trace_H0)

# å®šä¹‰å¤‡æ‹©å‡è®¾æ¨¡å‹ï¼ˆåŒ…å«æˆªè·å’Œæ–œç‡çš„æ¨¡å‹ï¼‰
with pm.Model() as model_H1:
    
    beta_0 = pm.Normal("beta_0", mu=5, sigma=2)        
    beta_1 = pm.Normal("beta_1", mu=0, sigma=1)      
    sigma = pm.Exponential("sigma", 3)                    
    x = pm.MutableData("x", df['Label'])         
    mu = beta_0 + beta_1 * x
    likelihood = pm.Normal("y_est", mu=mu, sigma=sigma, observed=df['RT_sec'])  
    trace_H1 = pm.sample(draws=5000, tune=1000, chains=4,discard_tuned_samples=True, random_seed=84735)
    pm.compute_log_likelihood(trace_H1)
```

```python
# è®¡ç®—è´å¶æ–¯å› å­
model_compare = az.compare({"Label": trace_H0, "Null model": trace_H1}, method='BB-pseudo-BMA')
weight_H0 = model_compare.loc["Label", "weight"]
weight_H1 = model_compare.loc["Null model", "weight"]
BF_10 = weight_H1 / weight_H0
print(f"è´å¶æ–¯å› å­ (BF_10): {BF_10}")
```
> è´å¶æ–¯å› å­ (BF_10): 10.494588319350406

### Testing against a null-region

ç°åœ¨ï¼Œæˆ‘ä»¬è¯å®äº†$\beta_1 \neq 0$ï¼Œå³è‡ªæˆ‘å’Œä»–äººæ¡ä»¶å¯¹äºååº”æ—¶é—´æœ‰å·®å¼‚ï¼Œä½†è¿™ä¸ªå·®å¼‚ä¼šä¸ä¼šéå¸¸å°ï¼Œæ˜¯å¦åœ¨æˆ‘ä»¬è®¤ä¸ºå¯ä»¥å¿½ç•¥çš„åŒºé—´å†…å‘¢ï¼Ÿ

***å›é¡¾ ROPE***

åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºè¿‡å¦‚ä½•ä½¿ç”¨ HDI å’Œ ROPE æ¥è¿›è¡Œå‡è®¾æ£€éªŒã€‚
æˆ‘ä»¬å‡è®¾äº† $\beta_1$ çš„å€¼åœ¨ $[-0.05, 0.05]$ èŒƒå›´å†…å¯ä»¥è§†ä¸ºå®ç”¨ç­‰æ•ˆåŒºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ
å¦‚æœ $\beta_1$ è½åœ¨è¿™ä¸ªåŒºé—´å†…ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º self å’Œ other æ¡ä»¶ä¹‹é—´çš„ååº”æ—¶é—´å·®å¼‚å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä»è€Œåœ¨å®è·µä¸Šè®¤ä¸ºä¸¤è€…æ— æ˜¾è‘—å·®å¼‚ã€‚

***ROPE å¯¹äºè´å¶æ–¯å› å­çš„æ„ä¹‰***

- åœ¨å‡è®¾æ£€éªŒä¸­ï¼Œè®¾å®šä¸€ä¸ªâ€œé›¶åŒºåŸŸâ€ï¼ˆnull regionï¼‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåœ¨å®é™…æ„ä¹‰ä¸Šè§†ä¸ºâ€œæ— æ•ˆâ€çš„æ•ˆæœèŒƒå›´ã€‚

- é€šè¿‡è®¾å®šé›¶åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡ï¼Œè¿›è€Œè®¡ç®—è´å¶æ–¯å› å­æ¥é‡åŒ–æ•°æ®å¯¹å‡è®¾çš„æ”¯æŒå¼ºåº¦ã€‚

- æˆ‘ä»¬å¯ä»¥è®¡ç®— "label" æ¡ä»¶ä¸‹ååº”æ—¶é—´å·®å¼‚è½åœ¨é›¶å‡è®¾åŒºé—´ä¹‹å¤–çš„å…ˆéªŒæ¦‚ç‡ï¼Œä»¥åŠè½åœ¨é›¶å‡è®¾åŒºé—´ä¹‹å†…çš„å…ˆéªŒæ¦‚ç‡ï¼Œä»è€Œå¾—åˆ°æˆ‘ä»¬çš„å…ˆéªŒæ¦‚ç‡æ¯”ï¼ˆprior oddsï¼‰ã€‚

$$
BF_{10}=\frac{P(Data|H_1)}{P(Data|H_0)}=\frac{P(Data|\beta_1\notin[-0.05,0.05])}{P(Data|\beta_1\in[-0.05,0.05])}
$$

ç”±äº arviz æ²¡æœ‰æä¾›ç›´æ¥è®¡ç®—åŒºé—´å‡è®¾æ£€éªŒçš„æ–¹æ³•ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ã€‚

æ ¹æ®ä¸Šé¢å…¬å¼ï¼Œè´å¶æ–¯å› å­ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šå…ˆéªŒæ¦‚ç‡æ¯” + åéªŒæ¦‚ç‡æ¯”ã€‚

> å¦‚æœå¤§å®¶è§‰å¾—pymcåœ¨å¿ƒç†å­¦ç ”ç©¶ä¸­ç”¨å¾—è¾ƒå°‘ï¼Œä¹Ÿå¯ä»¥åœ¨Rä¸­å®ç°ï¼Œåˆ©ç”¨Rçš„ä¸€æ•´å¥—è´å¶æ–¯ä½“ç³»å»è¿›è¡Œå·¥ä½œã€‚
> å‚è€ƒèµ„æ–™ï¼šhttps://easystats.github.io/bayestestR/articles/bayes_factors.html#testing-against-a-null-region

- ä¸‹é¢æˆ‘ä»¬å…ˆè®¡ç®—å…ˆéªŒæ¦‚ç‡æ¯”

```python
def calculate_odds(tace_samples, region = [-0.05, 0.05]):
    
    # è®¡ç®—åŒºé—´ [-0.05, 0.05] å†…çš„æ ·æœ¬
    in_range = tace_samples[(tace_samples >= region[0]) & (tace_samples <= region[1])]

    # è®¡ç®—åŒºé—´å¤–çš„æ ·æœ¬
    out_of_range = tace_samples[(tace_samples < region[0]) | (tace_samples > region[1])]

    # è®¡ç®—åŒºé—´å†…å¤–çš„æ¯”ä¾‹
    P_in_range = len(in_range) / len(tace_samples)
    P_out_of_range = len(out_of_range) / len(tace_samples)

    # è®¡ç®—æ¯”ç‡
    ratio = P_out_of_range / P_in_range
    return ratio
```

```python
prior_samples = trace.prior['beta_1'].values.reshape(-1)

prior_odds = calculate_odds(prior_samples, region=[-0.05, 0.05])

print(f"å…ˆéªŒæ¦‚ç‡æ¯”ï¼ˆprior oddsï¼‰: {prior_odds:.4f}")
```
å…ˆéªŒæ¦‚ç‡æ¯”ï¼ˆprior oddsï¼‰: 24.0000

```python
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns


def plot_region(trace_samples, region=[-0.05,0.05], dist_type="Prior", ax=None):
    
    if ax is None:
        ax = plt.gca()
    
    kde = sns.kdeplot(trace_samples, color="black", linewidth=2, ax=ax)

    # è·å–æ ¸å¯†åº¦ä¼°è®¡çš„æ›²çº¿æ•°æ®
    x, y = kde.get_lines()[0].get_data()

    # é«˜äº® [-0.05, 0.05] åŒºé—´çš„å¯†åº¦
    ax.fill_between(
        x, y,
        where=(x >= region[0]) & (x <= region[1]),
        color="blue",
        alpha=0.3,
        label="Null"
    )

    # é«˜äº®åŒºé—´ä¹‹å¤–ï¼ˆæ›¿ä»£åŒºåŸŸï¼‰
    ax.fill_between(
        x, y,
        where=(x < region[0]) | (x > region[1]),
        color="yellow",
        alpha=0.3,
        label="Alternative"
    )

    # å›¾ä¾‹å’Œæ ‡é¢˜
    ax.set_title(f"{dist_type} Distribution with Null Region")
    ax.set_ylabel("Density")
    ax.legend(title=f"{dist_type} regions")
```

```python
fig, ax = plt.subplots(figsize=(6,4))

plot_region(prior_samples,ax=ax)

sns.despine()

# æ˜¾ç¤ºå›¾å½¢
plt.show()
```

![alt text](image-6.png)

- è¿™é‡Œçš„Nullå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬è®¾å®šçš„é›¶åŒºé—´[-0.05,0.05]ï¼Œå®ƒæ˜¯ç”¨ç´«è‰²éƒ¨åˆ†çš„é¢ç§¯æ¥è¡¨ç¤ºã€‚å› æ­¤ï¼ŒPrior oddså®é™…ä¸Šå°±æ˜¯ç´«è‰²éƒ¨åˆ†ä¸é»„è‰²éƒ¨åˆ†é¢ç§¯çš„æ¯”å€¼ã€‚

æˆ‘ä»¬ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•è®¡ç®—åéªŒæ¦‚ç‡æ¯”ï¼ˆPosterior Oddsï¼‰ï¼Œè¯„ä¼°æ•°æ®æ›´æ–°åå‚æ•°å€¼åœ¨é›¶å‡è®¾åŒºé—´å†…å’ŒåŒºé—´å¤–çš„ç›¸å¯¹æ”¯æŒç¨‹åº¦ã€‚

```python
posterior_samples = trace.posterior['beta_1'].values.reshape(-1)

posterior_odds = calculate_odds(posterior_samples, region=[-0.05, 0.05])

print(f"åéªŒæ¦‚ç‡æ¯”ï¼ˆposterior oddsï¼‰: {posterior_odds:.4f}")
```
åéªŒæ¦‚ç‡æ¯”ï¼ˆposterior oddsï¼‰: 57.4795

```python
fig, ax = plt.subplots(figsize=(6,4))

plot_region(posterior_samples,dist_type="Posterior", ax=ax)

sns.despine()

# æ˜¾ç¤ºå›¾å½¢
plt.show()
```

![alt text](image-7.png)

é€šè¿‡å…ˆå‰çš„è´å¶æ–¯å› å­è®¡ç®—å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è´å¶æ–¯å› å­ä¸ºå…ˆéªŒæ¦‚ç‡æ¯”å’ŒåéªŒæ¦‚ç‡æ¯”çš„æ¯”å€¼ï¼š

$$
BF_{10}=\frac{posterior~odds}{prior~odds}
$$

```python
BF_10 = (posterior_odds)/(prior_odds)

print(f"è´å¶æ–¯å› å­ï¼ˆBF 10ï¼‰: {BF_10:.4f}")
```
è´å¶æ–¯å› å­ï¼ˆ$BF_{10}$ï¼‰: 2.3950

é€šè¿‡å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬å°†$H_0$çš„é›¶åŒºé—´æ‰©å±•ä¸€éƒ¨åˆ†åï¼Œè´å¶æ–¯å› å­æ”¯æŒ$H_1$çš„å¼ºåº¦ä¼šæœ‰æ‰€ä¸‹é™ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯è§†åŒ–å…ˆéªŒå’ŒåéªŒåˆ†å¸ƒï¼Œä»è€Œæ¸…æ™°åœ°å±•ç¤ºå‡ºæ•°æ®å¯¹é›¶å‡è®¾åŒºåŸŸå†…å¤–çš„æ”¯æŒåº¦å¦‚ä½•å‘ç”Ÿäº†å˜åŒ–ï¼š

```python
import numpy as np
import matplotlib.pyplot as plt
import arviz as az
import seaborn as sns

# ç»˜åˆ¶å¯†åº¦å›¾
plt.figure(figsize=(8, 5))

# ç»˜åˆ¶å…ˆéªŒåˆ†å¸ƒçš„å¯†åº¦æ›²çº¿
az.plot_kde(prior_samples, label="prior", plot_kwargs={"color": "cyan", "alpha": 0.5}, fill_kwargs={"alpha": 0.3})

# ç»˜åˆ¶åéªŒåˆ†å¸ƒçš„å¯†åº¦æ›²çº¿
az.plot_kde(posterior_samples, label="posterior", plot_kwargs={"color": "coral", "alpha": 0.6}, fill_kwargs={"alpha": 0.3})

# æ·»åŠ ä¸€æ¡å‚ç›´è™šçº¿ï¼Œè¡¨ç¤ºé›¶æ•ˆåº”å‚è€ƒå€¼ï¼ˆ0ï¼‰
plt.axvline(0, color="grey", linestyle="--", linewidth=1)

# æ ‡æ³¨é›¶å‡è®¾åŒºåŸŸ
plt.fill_betweenx([0, 8], -0.05, 0.05, color="blue", alpha=0.2) 

# è®¾ç½®xè½´èŒƒå›´
plt.xlim(-1,1)

# è®¾ç½®å›¾ä¾‹å’Œæ ‡ç­¾
plt.legend(title="Distribution", loc="upper right")
plt.xlabel("beta_1")
plt.ylabel("Density")
plt.title("Prior and Posterior Distribution")

# ç§»é™¤é¡¶éƒ¨å’Œå³ä¾§è¾¹æ¡†
sns.despine()

# æ˜¾ç¤ºå›¾å½¢
plt.show()
```

![alt text](image-8.png)

æ€»ç»“ï¼šé€šè¿‡å¯è§†åŒ–ï¼Œå¯ä»¥å‘ç°å…ˆéªŒåˆ†å¸ƒçš„è¾ƒå¤§éƒ¨åˆ†åœ¨é›¶å‡è®¾åŒºåŸŸå†…ï¼Œè€ŒåéªŒåˆ†å¸ƒåˆ™ä¸»è¦é›†ä¸­åœ¨é›¶å‡è®¾åŒºåŸŸå¤–ï¼Œè¡¨æ˜æ•°æ®å¯¹å¤‡æ‹©å‡è®¾æä¾›äº†æ”¯æŒï¼Œå°½ç®¡æ”¯æŒçš„åŠ›åº¦ç›¸å¯¹æœ‰é™ã€‚

åŒæ—¶ï¼Œé€šè¿‡ç›´æ¥è®¡ç®—è´å¶æ–¯å› å­çš„ç»“æœä¹Ÿå¯å¾—å‡ºï¼šæ•°æ®æä¾›äº†2.3879å€çš„è¯æ®è¯æ˜$\beta_1$è½åœ¨[-0.05,0.05]åŒºé—´å¤–çš„æ¦‚ç‡æ›´å¤§ã€‚

- å› æ­¤ï¼Œæ¯”å€¼ç›´æ¥è®¡ç®—çš„ç»“æœå’Œå¯è§†åŒ–çš„ç»“æœåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œä¸¤è€…éƒ½è¡¨æ˜æ•°æ®å¯¹å¤‡æ‹©å‡è®¾çš„æ”¯æŒå­˜åœ¨ï¼Œä½†å¹¶ä¸éå¸¸å¼ºã€‚

æ¥ä¸‹æ¥ï¼Œå¯ä»¥å°è¯•è‡ªè¡Œç»ƒä¹ ä¸€ä¸‹å…·æœ‰æ–¹å‘æ€§çš„å•ä¾§æ£€éªŒï¼š

### ç»ƒä¹ : Directional hypotheses

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æ•°æ®æ”¯æŒåœ¨selfå’Œotheræ¡ä»¶ä¸‹çš„ååº”æ—¶é—´æœ‰å·®å¼‚ï¼Œè€Œæˆ‘ä»¬å¯¹äºå…¶æ•ˆåº”çš„æ–¹å‘ï¼ˆæ­£å‘æˆ–è´Ÿå‘ï¼‰æœ‰å…ˆéªŒå‡è®¾ï¼Œå³åœ¨â€œselfâ€æ¡ä»¶ä¸‹çš„ååº”æ—¶é—´æ›´çŸ­ï¼Œ

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡Directional hypotheses æ£€éªŒæ•ˆåº”æ˜¯å¦æœç€æˆ‘ä»¬é¢„æœŸçš„æ–¹å‘å‘å±•ï¼Œè®¡ç®—æ–¹å‘å‡è®¾ï¼ˆâ€œå•ä¾§â€ï¼‰çš„è´å¶æ–¯å› å­ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æµ‹è¯•çš„æ˜¯åœ¨â€œselfâ€æ¡ä»¶ä¸‹çš„ååº”æ—¶é—´æ˜¯å¦æ¯”â€œotherâ€æ¡ä»¶æ›´çŸ­ï¼Œå› æ­¤å¤‡æ‹©å‡è®¾å°†é™åˆ¶åœ¨é›¶å‡è®¾ï¼ˆç‚¹æˆ–åŒºé—´ï¼‰çš„å·¦ä¾§åŒºåŸŸï¼Œå³æ›´å€¾å‘è´Ÿå‘çš„æ•ˆæœã€‚

é‚£ä¹ˆ$H_1ï¼š\beta_1<0$è¡¨ç¤ºâ€œselfâ€æ¡ä»¶ä¸‹ååº”æ—¶è¾ƒçŸ­çš„æƒ…å†µ

æ€è€ƒğŸ¤”ï¼šå¦‚ä½•é€šè¿‡è´å¶æ–¯å› å­é‡åŒ–æ”¯æŒè¯¥å‡è®¾çš„ç›¸å¯¹è¯æ®å¼ºåº¦å‘¢?

```python
import numpy as np
import matplotlib.pyplot as plt
import arviz as az
import seaborn as sns

# è¯·ç›´æ¥è¿è¡Œï¼Œæ— éœ€ä¿®æ”¹
# è¿™é‡Œç”±äºæ˜¯å•ä¾§æ£€éªŒï¼Œå› æ­¤éœ€è¦æ”¹å˜regionçš„æ–¹å‘æ€§
def calculate_odds(tace_samples, region = [-0.05, 0.05]):
    
    # è®¡ç®—åŒºé—´ [-0.05, 0.05] å†…çš„æ ·æœ¬ï¼Œregion[0]å’Œ[1]åˆ†åˆ«ä»£è¡¨åŒºé—´çš„ä¸‹é™å’Œä¸Šé™
    in_range = tace_samples[(tace_samples >= region[0]) & (tace_samples <= region[1])]

    # è®¡ç®—åŒºé—´å¤–çš„æ ·æœ¬ï¼Œå³å°äºä¸‹é™ æˆ– å¤§äºä¸Šé™
    out_of_range = tace_samples[(tace_samples < region[0]) | (tace_samples > region[1])]

    # è®¡ç®—åŒºé—´å†…å¤–çš„æ¯”ä¾‹ï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯é€šè¿‡è®¡ç®—å€¼çš„æ•°é‡æ¥è¿‘ä¼¼é¢ç§¯
    P_in_range = len(in_range) / len(tace_samples)
    P_out_of_range = len(out_of_range) / len(tace_samples)

    # è®¡ç®—æ¯”ç‡
    ratio = P_out_of_range / P_in_range
    return ratio

def plot_region(trace_samples, region=[-0.05,0.05], dist_type="Prior", ax=None):
    
    if ax is None:
        ax = plt.gca()
    
    kde = sns.kdeplot(trace_samples, color="black", linewidth=2, ax=ax)

    # è·å–æ ¸å¯†åº¦ä¼°è®¡çš„æ›²çº¿æ•°æ®
    x, y = kde.get_lines()[0].get_data()

    # é«˜äº® [-0.05, 0.05] åŒºé—´çš„å¯†åº¦
    ax.fill_between(
        x, y,
        where=(x >= region[0]) & (x <= region[1]),
        color="blue",
        alpha=0.3,
        label="Null"
    )

    # é«˜äº®åŒºé—´ä¹‹å¤–ï¼ˆæ›¿ä»£åŒºåŸŸï¼‰
    ax.fill_between(
        x, y,
        where=(x < region[0]) | (x > region[1]),
        color="yellow",
        alpha=0.3,
        label="Alternative"
    )

    # å›¾ä¾‹å’Œæ ‡é¢˜
    ax.set_title(f"{dist_type} Distribution with Null Region")
    ax.set_ylabel("Density")
    ax.legend(title=f"{dist_type} regions")
```

```python
#=====================================
#      åŸºäºæ–¹å‘çš„è´å¶æ–¯å› å­è®¡ç®—
#      è‡ªè¡Œç»ƒä¹ 
#=====================================

# è·å– beta_1çš„å…ˆéªŒåˆ†å¸ƒçš„é‡‡æ ·
# beta_1_prior = ...


# è·å– beta_1çš„åéªŒåˆ†å¸ƒçš„é‡‡æ ·
# beta_1_posterior = ...
```

ç­”æ¡ˆï¼š
```python
#=====================================
#      åŸºäºæ–¹å‘çš„è´å¶æ–¯å› å­è®¡ç®—
#      è‡ªè¡Œç»ƒä¹ 
#=====================================

# è·å– beta_1çš„å…ˆéªŒåˆ†å¸ƒçš„é‡‡æ ·
beta_1_prior = trace.prior['beta_1'].values.reshape(-1)

# è·å– beta_1çš„åéªŒåˆ†å¸ƒçš„é‡‡æ ·
beta_1_posterior = trace.posterior['beta_1'].values.reshape(-1)
```

```python
# å®šä¹‰åŒºé—´
from math import inf

# region = ...

# è®¡ç®—å…ˆéªŒæ¯”

# prior_odds = ...

# è®¡ç®—åéªŒæ¯”
# posterior_odds = ...

# è®¡ç®—è´å¶æ–¯å› å­
# bayes_factor = ...

print("bayes_factor:", bayes_factor)
```

ç­”æ¡ˆï¼š
```python
# å®šä¹‰åŒºé—´
from math import inf
region = [-inf,0]  #-infä¸ºè´Ÿæ— ç©·

# è®¡ç®—å…ˆéªŒæ¯”
prior_odds = calculate_odds(beta_1_prior, region)

# è®¡ç®—åéªŒæ¯”
posterior_odds = calculate_odds(beta_1_posterior, region)

# è®¡ç®—è´å¶æ–¯å› å­
bayes_factor = posterior_odds / prior_odds

print("bayes_factor:", bayes_factor)
```

```python
# æœ€åæ£€æŸ¥ç»“æœï¼Œå‰é¢éƒ¨åˆ†çš„ä»£ç è¿è¡Œæ— è¯¯åï¼Œè¯·ç›´æ¥è¿è¡Œè¯¥ä»£ç å—

# ç»˜åˆ¶å¯†åº¦å›¾
plt.figure(figsize=(8, 5))

# ç»˜å›¾
az.plot_kde(beta_1_prior, label="prior", plot_kwargs={"color": "cyan", "alpha": 0.5}, fill_kwargs={"alpha": 0.3})

az.plot_kde(beta_1_posterior, label="posterior", plot_kwargs={"color": "coral", "alpha": 0.6}, fill_kwargs={"alpha": 0.3})

# æ·»åŠ å‚ç›´è™šçº¿
plt.axvline(0, color="grey", linestyle="--", linewidth=1)

# æ ‡æ³¨é›¶å‡è®¾åŒºåŸŸ
plt.fill_betweenx([0, 8], -1, 0, color="blue", alpha=0.2) 

plt.xlim(-1,1)

# è®¾ç½®å›¾ä¾‹å’Œæ ‡ç­¾
plt.legend(title="Distribution", loc="upper right")
plt.xlabel("beta_1")
plt.ylabel("Density")
plt.title("Prior and Posterior Distribution")

sns.despine()

plt.show()
```

***æ€»ç»“***

- è´å¶æ–¯å› å­è¾ƒä¼ ç»Ÿç»Ÿè®¡æ–¹æ³•æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œå…¶ä¸­æœ€çªå‡ºçš„ä¼˜åŠ¿æ˜¯å¯¹é›¶å‡è®¾å’Œå¤‡æ‹©å‡è®¾ä¸€è§†åŒä»ã€‚è¿™ä¸€æ–¹é¢èƒ½å¤Ÿå¸®åŠ©ç ”ç©¶è€…è§£å†³ä¸ºé›¶å‡è®¾æä¾›è¯æ®çš„é—®é¢˜ï¼Œå¦ä¸€ æ–¹é¢è¿˜èƒ½å¸®åŠ©ç ”ç©¶è€…æ‹“å®½æ€è·¯ï¼Œå¦‚æœ¬èŠ‚è¯¾ä»‹ç»äº†ä¸‰ç§è´å¶æ–¯å› å­çš„è®¡ç®—ä¸åº”ç”¨ã€‚

- ä¸ä¼ ç»Ÿçš„På€¼ä¸åŒï¼Œè´å¶æ–¯å› å­ä¸ä»…èƒ½å¤Ÿå‘Šè¯‰æˆ‘ä»¬æ˜¯å¦æ‹’ç»é›¶å‡è®¾ï¼Œè¿˜èƒ½å±•ç¤ºæ•°æ®æ”¯æŒå“ªä¸€ä¸ªå‡è®¾çš„è¯æ®å¼ºåº¦ã€‚

- æœ€åï¼Œè¯·å¤§å®¶ä¸è¦è°¨æ…çœ‹å¾…På€¼ï¼ŒPå€¼å¹¶ä¸æ•™ä½ ç›¸ä¿¡/ä¸ç›¸ä¿¡ä»€ä¹ˆï¼Œè€Œåªæ˜¯ä¸ºä½ ä¿®æ­£è‡ªå·±çš„ä¿¡å¿µæä¾›å‚è€ƒã€‚

